import React, { useState, useEffect } from 'react';
import { Upload, Users, Trophy, FileText, X, LogIn, LogOut } from 'lucide-react';

export default function AstralFC() {
  const [activeSection, setActiveSection] = useState('inicio');
  const [estrategias, setEstrategias] = useState([]);
  const [fotos, setFotos] = useState([]);
  const [noticias, setNoticias] = useState([]);
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [showLogin, setShowLogin] = useState(false);
  const [loading, setLoading] = useState(true);

  const ADMIN_EMAIL = 'raizox67@gmail.com';

  // Cargar datos al iniciar
  useEffect(() => {
    loadData();
  }, []);

  const loadData = async () => {
    setLoading(true);
    try {
      // Cargar estrategias
      const estrategiasResult = await window.storage.get('astral_estrategias');
      if (estrategiasResult) {
        setEstrategias(JSON.parse(estrategiasResult.value));
      }

      // Cargar fotos
      const fotosResult = await window.storage.get('astral_fotos');
      if (fotosResult) {
        setFotos(JSON.parse(fotosResult.value));
      }

      // Cargar noticias
      const noticiasResult = await window.storage.get('astral_noticias');
      if (noticiasResult) {
        setNoticias(JSON.parse(noticiasResult.value));
      }
    } catch (error) {
      console.log('Iniciando con datos vacíos');
    }
    setLoading(false);
  };

  const saveEstrategias = async (newEstrategias) => {
    try {
      await window.storage.set('astral_estrategias', JSON.stringify(newEstrategias));
      setEstrategias(newEstrategias);
    } catch (error) {
      alert('Error al guardar. Intenta de nuevo.');
    }
  };

  const saveFotos = async (newFotos) => {
    try {
      await window.storage.set('astral_fotos', JSON.stringify(newFotos));
      setFotos(newFotos);
    } catch (error) {
      alert('Error al guardar. Intenta de nuevo.');
    }
  };

  const saveNoticias = async (newNoticias) => {
    try {
      await window.storage.set('astral_noticias', JSON.stringify(newNoticias));
      setNoticias(newNoticias);
    } catch (error) {
      alert('Error al guardar. Intenta de nuevo.');
    }
  };

  const handleLogin = async () => {
    if (email.toLowerCase() === ADMIN_EMAIL.toLowerCase() && password === 'AstralFC2026') {
      setIsAuthenticated(true);
      setShowLogin(false);
      setEmail('');
      setPassword('');
    } else {
      alert('Email o contraseña incorrectos');
    }
  };

  const handleLogout = () => {
    setIsAuthenticated(false);
    setEmail('');
    setPassword('');
  };

  const handleFileUpload = (e) => {
    if (!isAuthenticated) {
      alert('Debes iniciar sesión para subir fotos');
      return;
    }

    const files = Array.from(e.target.files);
    
    files.forEach(file => {
      const reader = new FileReader();
      reader.onload = (event) => {
        const newFoto = {
          id: Date.now() + Math.random(),
          url: event.target.result,
          nombre: file.name,
          fecha: new Date().toLocaleDateString()
        };
        const updatedFotos = [...fotos, newFoto];
        saveFotos(updatedFotos);
      };
      reader.readAsDataURL(file);
    });
  };

  const agregarEstrategia = () => {
    if (!isAuthenticated) {
      alert('Debes iniciar sesión para agregar estrategias');
      return;
    }

    const titulo = prompt('Título de la estrategia:');
    if (!titulo) return;
    
    const descripcion = prompt('Descripción:');
    if (!descripcion) return;

    const newEstrategia = {
      id: Date.now(),
      titulo,
      descripcion,
      fecha: new Date().toLocaleDateString()
    };
    
    saveEstrategias([...estrategias, newEstrategia]);
  };

  const agregarNoticia = () => {
    if (!isAuthenticated) {
      alert('Debes iniciar sesión para agregar noticias');
      return;
    }

    const titulo = prompt('Título de la noticia:');
    if (!titulo) return;
    
    const contenido = prompt('Contenido:');
    if (!contenido) return;

    const newNoticia = {
      id: Date.now(),
      titulo,
      contenido,
      fecha: new Date().toLocaleDateString()
    };
    
    saveNoticias([...noticias, newNoticia]);
  };

  const eliminar = (id, type) => {
    if (!isAuthenticated) {
      alert('Debes iniciar sesión para eliminar contenido');
      return;
    }

    if (type === 'foto') {
      const updated = fotos.filter(f => f.id !== id);
      saveFotos(updated);
    }
    if (type === 'estrategia') {
      const updated = estrategias.filter(e => e.id !== id);
      saveEstrategias(updated);
    }
    if (type === 'noticia') {
      const updated = noticias.filter(n => n.id !== id);
      saveNoticias(updated);
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-gradient-to-b from-indigo-950 via-purple-900 to-black">
        <div className="text-white text-2xl">Cargando Astral FC...</div>
      </div>
    );
  }

  return (
    <div className="min-h-screen relative overflow-hidden">
      {/* Fondo espacial animado */}
      <div className="fixed inset-0 bg-gradient-to-b from-indigo-950 via-purple-900 to-black">
        <div className="absolute inset-0 opacity-50">
          {[...Array(100)].map((_, i) => (
            <div
              key={i}
              className="absolute bg-white rounded-full"
              style={{
                width: Math.random() * 3 + 'px',
                height: Math.random() * 3 + 'px',
                top: Math.random() * 100 + '%',
                left: Math.random() * 100 + '%',
                animation: `twinkle ${Math.random() * 3 + 2}s infinite`
              }}
            />
          ))}
        </div>
      </div>

      {/* Modal de Login */}
      {showLogin && (
        <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
          <div className="bg-gradient-to-br from-purple-900 to-indigo-900 p-8 rounded-2xl border-2 border-purple-400 max-w-md w-full mx-4">
            <h3 className="text-2xl font-bold text-white mb-6 text-center">Acceso Administrador</h3>
            <input
              type="email"
              placeholder="Email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="w-full px-4 py-3 rounded-lg mb-4 bg-white bg-opacity-20 text-white placeholder-purple-300 border border-purple-400 focus:outline-none focus:border-purple-300"
            />
            <input
              type="password"
              placeholder="Contraseña"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
              className="w-full px-4 py-3 rounded-lg mb-6 bg-white bg-opacity-20 text-white placeholder-purple-300 border border-purple-400 focus:outline-none focus:border-purple-300"
            />
            <div className="flex gap-3">
              <button
                onClick={handleLogin}
                className="flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:shadow-lg hover:shadow-green-500/50 transition-all font-bold"
              >
                Entrar
              </button>
              <button
                onClick={() => setShowLogin(false)}
                className="flex-1 px-6 py-3 bg-gradient-to-r from-red-500 to-pink-600 text-white rounded-lg hover:shadow-lg hover:shadow-red-500/50 transition-all font-bold"
              >
                Cancelar
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Contenido */}
      <div className="relative z-10">
        {/* Header */}
        <header className="bg-black bg-opacity-60 backdrop-blur-md border-b border-purple-500 shadow-lg shadow-purple-500/20">
          <div className="container mx-auto px-4 py-6">
            <div className="flex justify-between items-center mb-4">
              <div className="text-center flex-1">
                <h1 className="text-5xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 mb-2">
                  ⚽ ASTRAL FC ⭐
                </h1>
                <p className="text-purple-300 text-lg">Jugando entre las estrellas</p>
              </div>
              <div>
                {isAuthenticated ? (
                  <button
                    onClick={handleLogout}
                    className="px-4 py-2 bg-gradient-to-r from-red-500 to-pink-600 text-white rounded-lg hover:shadow-lg hover:shadow-red-500/50 transition-all flex items-center gap-2"
                  >
                    <LogOut className="w-4 h-4" />
                    Salir
                  </button>
                ) : (
                  <button
                    onClick={() => setShowLogin(true)}
                    className="px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:shadow-lg hover:shadow-blue-500/50 transition-all flex items-center gap-2"
                  >
                    <LogIn className="w-4 h-4" />
                    Admin
                  </button>
                )}
              </div>
            </div>
            
            <nav className="flex justify-center gap-4 flex-wrap">
              {['inicio', 'estrategias', 'galería', 'noticias'].map(section => (
                <button
                  key={section}
                  onClick={() => setActiveSection(section)}
                  className={`px-6 py-2 rounded-full transition-all ${
                    activeSection === section
                      ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-lg shadow-purple-500/50'
                      : 'bg-white bg-opacity-10 text-purple-200 hover:bg-opacity-20'
                  }`}
                >
                  {section.charAt(0).toUpperCase() + section.slice(1)}
                </button>
              ))}
            </nav>
          </div>
        </header>

        {/* Main Content */}
        <main className="container mx-auto px-4 py-8">
          {/* Inicio */}
          {activeSection === 'inicio' && (
            <div className="max-w-4xl mx-auto">
              <div className="bg-white bg-opacity-10 backdrop-blur-md rounded-2xl p-8 border border-purple-400 shadow-2xl shadow-purple-500/30">
                <h2 className="text-4xl font-bold text-white mb-6 text-center">
                  Bienvenido a Astral FC
                </h2>
                <div className="grid md:grid-cols-3 gap-6 mt-8">
                  <div className="text-center p-6 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl">
                    <Users className="w-12 h-12 mx-auto mb-3 text-white" />
                    <h3 className="text-xl font-bold text-white mb-2">Equipo</h3>
                    <p className="text-blue-100">Unidos como constelación</p>
                  </div>
                  <div className="text-center p-6 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl">
                    <Trophy className="w-12 h-12 mx-auto mb-3 text-white" />
                    <h3 className="text-xl font-bold text-white mb-2">Victoria</h3>
                    <p className="text-purple-100">Alcanzando las estrellas</p>
                  </div>
                  <div className="text-center p-6 bg-gradient-to-br from-pink-500 to-red-600 rounded-xl">
                    <FileText className="w-12 h-12 mx-auto mb-3 text-white" />
                    <h3 className="text-xl font-bold text-white mb-2">Estrategia</h3>
                    <p className="text-pink-100">Tácticas galácticas</p>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Estrategias */}
          {activeSection === 'estrategias' && (
            <div className="max-w-4xl mx-auto">
              <div className="bg-white bg-opacity-10 backdrop-blur-md rounded-2xl p-8 border border-purple-400">
                <h2 className="text-3xl font-bold text-white mb-6">Estrategias del Equipo</h2>
                {isAuthenticated && (
                  <button
                    onClick={agregarEstrategia}
                    className="mb-6 px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:shadow-lg hover:shadow-green-500/50 transition-all"
                  >
                    + Nueva Estrategia
                  </button>
                )}
                
                <div className="space-y-4">
                  {estrategias.map(est => (
                    <div key={est.id} className="bg-white bg-opacity-5 p-6 rounded-xl border border-purple-300 relative">
                      {isAuthenticated && (
                        <button
                          onClick={() => eliminar(est.id, 'estrategia')}
                          className="absolute top-4 right-4 text-red-400 hover:text-red-300"
                        >
                          <X className="w-5 h-5" />
                        </button>
                      )}
                      <h3 className="text-xl font-bold text-purple-300 mb-2">{est.titulo}</h3>
                      <p className="text-gray-300 mb-2">{est.descripcion}</p>
                      <p className="text-sm text-purple-400">Fecha: {est.fecha}</p>
                    </div>
                  ))}
                  {estrategias.length === 0 && (
                    <p className="text-gray-400 text-center py-8">No hay estrategias aún.</p>
                  )}
                </div>
              </div>
            </div>
          )}

          {/* Galería */}
          {activeSection === 'galería' && (
            <div className="max-w-6xl mx-auto">
              <div className="bg-white bg-opacity-10 backdrop-blur-md rounded-2xl p-8 border border-purple-400">
                <h2 className="text-3xl font-bold text-white mb-6">Galería de Fotos</h2>
                
                {isAuthenticated && (
                  <label className="mb-6 inline-block px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg hover:shadow-lg hover:shadow-blue-500/50 transition-all cursor-pointer">
                    <Upload className="w-5 h-5 inline mr-2" />
                    Subir Fotos
                    <input
                      type="file"
                      multiple
                      accept="image/*"
                      onChange={handleFileUpload}
                      className="hidden"
                    />
                  </label>
                )}

                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-6">
                  {fotos.map(foto => (
                    <div key={foto.id} className="relative group">
                      <img
                        src={foto.url}
                        alt={foto.nombre}
                        className="w-full h-48 object-cover rounded-lg border-2 border-purple-400"
                      />
                      {isAuthenticated && (
                        <button
                          onClick={() => eliminar(foto.id, 'foto')}
                          className="absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity"
                        >
                          <X className="w-4 h-4" />
                        </button>
                      )}
                      <p className="text-xs text-purple-300 mt-2">{foto.fecha}</p>
                    </div>
                  ))}
                </div>
                {fotos.length === 0 && (
                  <p className="text-gray-400 text-center py-8">No hay fotos aún.</p>
                )}
              </div>
            </div>
          )}

          {/* Noticias */}
          {activeSection === 'noticias' && (
            <div className="max-w-4xl mx-auto">
              <div className="bg-white bg-opacity-10 backdrop-blur-md rounded-2xl p-8 border border-purple-400">
                <h2 className="text-3xl font-bold text-white mb-6">Noticias del Club</h2>
                {isAuthenticated && (
                  <button
                    onClick={agregarNoticia}
                    className="mb-6 px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white rounded-lg hover:shadow-lg hover:shadow-orange-500/50 transition-all"
                  >
                    + Nueva Noticia
                  </button>
                )}
                
                <div className="space-y-4">
                  {noticias.map(noticia => (
                    <div key={noticia.id} className="bg-white bg-opacity-5 p-6 rounded-xl border border-purple-300 relative">
                      {isAuthenticated && (
                        <button
                          onClick={() => eliminar(noticia.id, 'noticia')}
                          className="absolute top-4 right-4 text-red-400 hover:text-red-300"
                        >
                          <X className="w-5 h-5" />
                        </button>
                      )}
                      <h3 className="text-xl font-bold text-purple-300 mb-2">{noticia.titulo}</h3>
                      <p className="text-gray-300 mb-2">{noticia.contenido}</p>
                      <p className="text-sm text-purple-400">Fecha: {noticia.fecha}</p>
                    </div>
                  ))}
                  {noticias.length === 0 && (
                    <p className="text-gray-400 text-center py-8">No hay noticias aún.</p>
                  )}
                </div>
              </div>
            </div>
          )}
        </main>

        {/* Footer */}
        <footer className="bg-black bg-opacity-60 backdrop-blur-md border-t border-purple-500 mt-12 py-6">
          <div className="container mx-auto px-4 text-center text-purple-300">
            <p>⭐ Astral FC - Donde el fútbol alcanza las estrellas ⭐</p>
            <p className="text-sm mt-2">© 2026 - Todos los derechos reservados</p>
          </div>
        </footer>
      </div>

      <style jsx>{`
        @keyframes twinkle {
          0%, 100% { opacity: 0.3; }
          50% { opacity: 1; }
        }
      `}</style>
    </div>
  );
}
